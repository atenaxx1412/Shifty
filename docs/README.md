# Shifty ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## æ¦‚è¦

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€Shifty ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã«é–¢ã™ã‚‹åŒ…æ‹¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ

### ğŸ“‹ [database-architecture.md](./database-architecture.md)
**ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ**
- Firestore ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦
- ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è¨­è¨ˆã¨ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
- å½¹å‰²ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹
- éšœå®³å¯¾å¿œã¨ãƒ‡ã‚£ã‚¶ã‚¹ã‚¿ãƒªã‚«ãƒãƒª

### ğŸ”§ [root-database-usage.md](./root-database-usage.md)
**Root ãƒ«ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³**
- ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…å‘ã‘æ©Ÿèƒ½
- å…¨æ¨©é™ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- åº—èˆ—æ¨ªæ–­çµ±è¨ˆã¨ãƒ¬ãƒãƒ¼ãƒˆ
- ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ã¨ç›£æŸ»ãƒ­ã‚°
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†æ“ä½œ

### ğŸª [manager-database-usage.md](./manager-database-usage.md)
**Manager ãƒ«ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³**
- åº—é•·å‘ã‘æ©Ÿèƒ½ã®è©³ç´°
- managerId ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿åˆ†é›¢
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆã¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- ã‚·ãƒ•ãƒˆãƒ»ã‚¹ã‚¿ãƒƒãƒ•ãƒ»äºˆç®—ç®¡ç†
- æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³

### âš¡ [firestore-optimization.md](./firestore-optimization.md)
**Firestore ã‚¯ã‚¨ãƒªæœ€é©åŒ–æˆ¦ç•¥**
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­è¨ˆã¨åˆ¶é™å›é¿
- JavaScriptå´ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æŠ€æ³•
- ä¸¦åˆ—ã‚¯ã‚¨ãƒªã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã¨ã‚³ã‚¹ãƒˆæœ€é©åŒ–
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¥ç¶šç®¡ç†

### ğŸ”— [service-layer-analysis.md](./service-layer-analysis.md)
**ã‚µãƒ¼ãƒ“ã‚¹å±¤ã®è©³ç´°åˆ†æ**
- StatsService, UserServiceç­‰ã®è¨­è¨ˆ
- ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®æŠ½è±¡åŒ–
- å‹å®‰å…¨æ€§ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ã‚µãƒ¼ãƒ“ã‚¹é–“é€£æºãƒ‘ã‚¿ãƒ¼ãƒ³
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹

## ä¸»è¦ãªè¨­è¨ˆåŸå‰‡

### ğŸ¯ ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
```typescript
// Root: å…¨ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
// Manager: managerId ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
// Staff: è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã®ã¿
```

### ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
```typescript
// 1. ä¸¦åˆ—ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
const [staff, shifts, budget] = await Promise.all([...]);

// 2. JavaScriptå´ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
const filtered = allData.filter(item => condition);

// 3. å¿…è¦æœ€å°é™ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
// è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’é¿ã‘ã€å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¯ã‚¨ãƒªã‚’æ´»ç”¨
```

### ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½
```typescript
// é¸æŠçš„ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
// å¿…è¦ãªå ´åˆã®ã¿ onSnapshot ã‚’ä½¿ç”¨
// ä¸è¦ãªæ¥ç¶šã¯è‡ªå‹•åˆ‡æ–­
```

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¦‚è¦

```mermaid
graph TD
    A[React Components] --> B[Service Layer]
    B --> C[Firestore]

    B1[StatsService] --> C1[çµ±è¨ˆè¨ˆç®—]
    B2[UserService] --> C2[ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†]
    B3[ShiftService] --> C3[ã‚·ãƒ•ãƒˆç®¡ç†]
    B4[BudgetService] --> C4[äºˆç®—è¨ˆç®—]

    C --> D[ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°]
    D --> A
```

## ä¸»è¦ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

| ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ | ç”¨é€” | ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ |
|------------|------|------------|
| `users` | å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± | Role-based |
| `shifts` | ã‚·ãƒ•ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« | managerId |
| `shiftRequests` | ã‚·ãƒ•ãƒˆå¸Œæœ›ç”³è«‹ | managerId |
| `shiftExchanges` | ã‚·ãƒ•ãƒˆäº¤æ› | managerId |
| `budgetCalculations` | äºˆç®—è¨ˆç®—çµæœ | managerId |
| `activityLogs` | ç›£æŸ»ãƒ­ã‚° | Root only |
| `systemSettings` | ã‚·ã‚¹ãƒ†ãƒ è¨­å®š | Root only |

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

- **å¹³å‡ã‚¯ã‚¨ãƒªæ™‚é–“**: < 200ms
- **ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰èª­ã¿è¾¼ã¿**: < 500ms
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°é…å»¶**: < 100ms
- **åŒæ™‚æ¥ç¶š**: æœ€å¤§100åº—èˆ—

## é–‹ç™ºè€…å‘ã‘ã‚¬ã‚¤ãƒ‰

### æ–°æ©Ÿèƒ½é–‹ç™ºæ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

1. **æ¨©é™ãƒã‚§ãƒƒã‚¯**: é©åˆ‡ãªå½¹å‰²åˆ¶é™ã‚’å®Ÿè£…
2. **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä¸è¦ã®è¨­è¨ˆ
3. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å€¤ã®æä¾›
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ä¸¦åˆ—ã‚¯ã‚¨ãƒªã®æ´»ç”¨
5. **ç›£æŸ»ãƒ­ã‚°**: é‡è¦æ“ä½œã®è¨˜éŒ²
6. **å‹å®‰å…¨æ€§**: TypeScript å‹å®šç¾©ã®æ›´æ–°

### ãƒ‡ãƒãƒƒã‚°ã®ãƒ’ãƒ³ãƒˆ

```typescript
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬
console.time('query-name');
const result = await queryFunction();
console.timeEnd('query-name');

// Firestore æ¥ç¶šçŠ¶æ…‹ç¢ºèª
onSnapshot(doc(db, 'system', 'health'), { includeMetadataChanges: true },
  (doc) => console.log('From cache:', doc.metadata.fromCache)
);
```

## é–¢é€£ãƒªã‚½ãƒ¼ã‚¹

- [Firebase Console](https://console.firebase.google.com/project/shifty-dc8fb/firestore)
- [ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç®¡ç†](https://console.firebase.google.com/project/shifty-dc8fb/firestore/indexes)
- [Firestore ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«](https://console.firebase.google.com/project/shifty-dc8fb/firestore/rules)

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´9æœˆ18æ—¥
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.0
**ä½œæˆè€…**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒãƒ¼ãƒ 